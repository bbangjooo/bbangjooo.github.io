<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> AutoRec: Autoencoders Meet Collaborative Filtering -bbangjo </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="Auto-Encoder framework for Recommendation System- AutoRec: Autoencoders Meet Collaborative Filtering"> <meta name="keywords" content="AutoRec: Autoencoders Meet Collaborative Filtering, bbangjo, Recommendation System,"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="bbangjo" property="og:site_name" /> <meta content="AutoRec: Autoencoders Meet Collaborative Filtering" property="og:title" /> <meta content="article" property="og:type" /> <meta content="Auto-Encoder framework for Recommendation System" property="og:description" /> <meta content="https://www.bbangjo.kr/blog/recsys-autorec" property="og:url" /> <meta content="2021-02-28T00:00:00+00:00" property="article:published_time" /> <meta content="https://www.bbangjo.kr/about/" property="article:author" /> <meta content="https://www.bbangjo.krhttps://user-images.githubusercontent.com/51329156/106574235-00e19300-657e-11eb-8a99-c5192cd8cabd.png" property="og:image" /> <meta content="Recommendation System" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="AutoRec: Autoencoders Meet Collaborative Filtering" /> <meta name="twitter:url" content="https://www.bbangjo.kr/blog/recsys-autorec" /> <meta name="twitter:description" content="Auto-Encoder framework for Recommendation System" /> <link rel="stylesheet" href="https://www.bbangjo.kr/assets/css/main.css" /> <!-- <link rel="stylesheet" href="https://www.bbangjo.kr/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="https://www.bbangjo.kr/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="https://www.bbangjo.kr/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="https://www.bbangjo.kr/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="https://www.bbangjo.kr/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="https://www.bbangjo.kr/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'https://www.bbangjo.kr' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="https://www.bbangjo.kr/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="https://www.bbangjo.kr/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="https://www.bbangjo.kr/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="https://www.bbangjo.kr/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="https://www.bbangjo.kr/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="https://www.bbangjo.kr/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="https://www.bbangjo.kr/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="https://www.bbangjo.kr/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="https://www.bbangjo.kr/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="https://www.bbangjo.kr/assets/js/search.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- (you can remove the below scripts but do buy me a coffee to show some support :) --> <!-- Maker widget <script> (function(d, h, m) { var js, fjs = d.getElementsByTagName(h)[0]; if (d.getElementById(m)) { return; } js = d.createElement(h); js.id = m; js.onload = function() { window.makerWidgetComInit({ position: "left", widget: "ofeeof264otl2l5g-zspk40eq2gaomj2n-higi2qphmveubksi" }); }; js.src = "https://makerwidget.com/js/embed.js"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "dhm"); </script> --> <!-- buy me a coffeee <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="sujaykundu" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="right" data-x_margin="10" data-y_margin="10" ></script> --> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">bbangjo</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="https://www.bbangjo.kr/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="https://www.bbangjo.kr/about" >About</a > </li> <li class="nav-item"> <a class="nav-link" href="https://www.bbangjo.kr/blog" >Blog</a > </li> </ul> </div> <!-- <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link" href="https://www.bbangjo.kr/get-started"> Get Started </a> </li> --> <!-- <li class="nav-item"> <a class="nav-link" id="olvy-target"> What's New </a> </li> --> <!-- <li class="nav-item"> <a class="nav-link" href="https://www.bbangjo.kr/styleguide"> Styleguide </a> </li> <li class="nav-item"> <button id="olvy-target" class="btn btn-dark"> What's New </button> </li> --> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <!-- <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher()" type="checkbox" name="checkbox" /> </li> --> </ul> </nav> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div><div class="main-container"> <div class="row justify-content-center" id="blog-post-container"> <div class="col-lg-10"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">AutoRec: Autoencoders Meet Collaborative Filtering</h1> <h4 class="post-meta">Auto-Encoder framework for Recommendation System</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="https://www.bbangjo.kr/blog/authors/bbangjo">bbangjo</a></span> </span > at <time datetime="2021-02-28 00:00:00 +0000" itemprop="datePublished" >Feb 28, 2021</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/recsys-autorec" ></span> <div class="post-categories"> Category : <a href="/blog/categories/Recommendation System" >Recommendation System</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="https://user-images.githubusercontent.com/51329156/106574235-00e19300-657e-11eb-8a99-c5192cd8cabd.png" alt="" /> <br /> <br /> <p>ë‚´ìš©ì´ ì›Œë‚™ ê°„ë‹¨í•˜ê³  ê¸€ë„ ì§§ì•„ì„œ ë¦¬ë·°ëŠ” ëª¨ë¸ê¹Œì§€ë§Œ ê°„ë‹¨íˆ í•˜ê³  ë°”ë¡œ êµ¬í˜„ìœ¼ë¡œ ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤.</p> <h2 id="autorec-autoencoders-meet-collaborative-filtering">AutoRec: Autoencoders Meet Collaborative Filtering</h2> <h3 id="abstract">ABSTRACT</h3> <p>ì´ ë…¼ë¬¸ì—ì„œëŠ” í˜‘ì—…í•„í„°ë§(ì´í•˜ CF)ë¥¼ ìœ„í•œ autoencoder í”„ë ˆì„ì›Œí¬ë¥¼ ì œì‹œí•©ë‹ˆë‹¤. ì €ìì˜ ê²½í—˜ì— ë”°ë¥´ë©´ <strong>AutoRec</strong>ì˜ ëª¨ë¸ì€ ì‘ê³  íš¨ìœ¨ì ìœ¼ë¡œ í•™ìŠµì´ ê°€ëŠ¥í•˜ê³  Movielens ë°ì´í„°ì…‹ê³¼ Netflix ë°ì´í„°ì…‹ì— ëŒ€í•´ ë‹¹ì‹œ state-of-the-art CF ê¸°ìˆ ì´ì—ˆë˜ biased MF, RBM-CF, LLORMAë³´ë‹¤ ì›”ë“±í•œ ì„±ëŠ¥ì„ ëƒˆë‹¤ê³  í•˜ë„¤ìš”.</p> <h3 id="-what-is-autoencoder-">ğŸ‘€ What is Autoencoder ?</h3> <p>ì¸íŠ¸ë¡œì—ì„œ ì„¤ëª…í–ˆë“¯ì´ ì´ ëª¨ë¸ì—ì„œëŠ” autoencoderë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ autoencoderê°€ ëŒ€ì²´ ë­˜ê¹Œìš”?</p> <blockquote> <p>ì˜¤í†  ì¸ì½”ë”ëŠ” ê°ë…ë˜ì§€ ì•Šì€ ë°©ì‹ìœ¼ë¡œ íš¨ìœ¨ì ì¸ ë°ì´í„° ì½”ë”©ì„ í•™ìŠµí•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì¸ê³µ ì‹ ê²½ë§ì˜ í•œ ìœ í˜•ì…ë‹ˆë‹¤. ì˜¤í†  ì¸ì½”ë”ì˜ ëª©ì ì€ ë„¤íŠ¸ì›Œí¬ê°€ ì‹ í˜¸ â€œë…¸ì´ì¦ˆâ€ë¥¼ ë¬´ì‹œí•˜ë„ë¡ í›ˆë ¨í•¨ìœ¼ë¡œì¨ ì¼ë°˜ì ìœ¼ë¡œ ì°¨ì› ê°ì†Œë¥¼ ìœ„í•œ ë°ì´í„° ì…‹ì— ëŒ€í•œ í‘œí˜„ì„ í•™ìŠµí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p> </blockquote> <p><em>ì¶œì²˜ : <a href="https://en.wikipedia.org/wiki/Autoencoder">ìœ„í‚¤í”¼ë””ì•„</a></em></p> <p>ì…ë ¥ì—ì„œ ì¶œë ¥ìœ¼ë¡œ ë³µì‚¬í•˜ëŠ” ì‹ ê²½ë§ì¸ë°, ì¤‘ê°„ì— ë…¸ì´ì¦ˆë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ í•´ì„œ ë‹¨ìˆœ ë³µì‚¬í•˜ì§€ ëª»í•˜ë„ë¡ ë§‰ê³  ì´ëŸ° ê³¼ì •ë“¤ì„ í†µí•´ì„œ ë°ì´í„°ì…‹ì„ íš¨ìœ¨ì ìœ¼ë¡œ í‘œí˜„í•˜ëŠ” ë°©ë²•ì„ í•™ìŠµí•©ë‹ˆë‹¤.</p> <p><img src="https://user-images.githubusercontent.com/51329156/106574235-00e19300-657e-11eb-8a99-c5192cd8cabd.png" alt="image" /></p> <p>ê·¸ë¦¼ì—ì„œë„ ì•Œ ìˆ˜ ìˆë“¯ì´ ì˜¤í† ì¸ì½”ë”ëŠ” í•­ìƒ ì¸ì½”ë”ì™€ ë””ì½”ë”, ë‘ ë¶€ë¶„ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p> <ul> <li> <p><strong>ì¸ì½”ë”(encoder)</strong> : ì¸ì§€ ë„¤íŠ¸ì›Œí¬(recognition network)ë¼ê³ ë„ í•˜ë©°, ì…ë ¥ì„ ë‚´ë¶€ í‘œí˜„ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p> </li> <li> <p><strong>ë””ì½”ë”(decoder)</strong> : ìƒì„± ë„¤íŠ¸ì›Œí¬(generative nework)ë¼ê³ ë„ í•˜ë©°, ë‚´ë¶€ í‘œí˜„ì„ ì¶œë ¥ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p> </li> </ul> <p>ì…ë ¥ê³¼ ì¶œë ¥ì¸µì˜ ë‰´ëŸ° ìˆ˜ê°€ ë™ì¼í•˜ë‹¤ëŠ” ê²ƒë§Œ ì œì™¸í•˜ë©´ ì¼ë°˜ì ì¸ MLPì™€ ë™ì¼í•œ êµ¬ì¡°ì¸ ê²ƒ ë˜í•œ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <strong>Loss function</strong>ì€ ì…ë ¥ê³¼ ì¬êµ¬ì„±ëœ ì…ë ¥ê°’, ì¦‰ ì¶œë ¥ì˜ ì°¨ì´ë¥¼ ê°€ì§€ê³  ê³„ì‚°í•©ë‹ˆë‹¤.</p> <p>ì •ë¦¬í•´ë³´ë©´ ì˜¤í† ì¸ì½”ë”ë¥¼ í†µí•´ ì…ë ¥ê°’ì„ <strong>ì¬êµ¬ì„±(reconstruction)</strong>í•˜ê³  ì…ë ¥ ë°ì´í„°ì—ì„œ ì¤‘ìš”í•œ íŠ¹ì„±ë“¤ì„ í•™ìŠµí•˜ëŠ” ì¹œêµ¬ì…ë‹ˆë‹¤. ì˜¤í† ì¸ì½”ë”ë„ ì¢…ë¥˜ê°€ ë§ì€ë°, í›„ì— í•„ìš”í•  ë•Œ ì¶”ê°€ì ìœ¼ë¡œ ë‹¤ë£¨ê² ìŠµë‹ˆë‹¤.</p> <p><strong>ì°¸ê³ </strong></p> <blockquote> <p>ğŸš€ <a href="https://excelsior-cjh.tistory.com/187">ì˜¤í† ì¸ì½”ë” (AutoEncoder)</a></p> </blockquote> <h3 id="the-autorec-model">THE AUTOREC MODEL</h3> <p>CFì—ì„œ mëª…ì˜ ì‚¬ìš©ìì™€, nê°œì˜ ì•„ì´í…œì— ëŒ€í•´ rating matrix \(R \in \mathbb{R}^{m \times n}\)ë¥¼ ê°€ì§‘ë‹ˆë‹¤. ê° User uëŠ” itemì— ëŒ€í•œ í‰ê°€ ë²¡í„° \(r^{(u)} = (R_{u1},R_{u2},...,R_{un})\)ë¥¼ ê°€ì§€ê³  Item iëŠ” ë§ˆì°¬ê°€ì§€ë¡œ \(r^{(i)} = (R_{1i},R_{2i},...,R_{mi})\)ë¡œ í‘œí˜„ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•ìœ¼ë¡œì˜ ì„¤ëª…ì€ Item-basedë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ê² ìŠµë‹ˆë‹¤. ì´ ëª¨ë¸ì—ì„œ í•˜ë ¤ëŠ” ì¼ì€ ì›ë˜ ì…ë ¥ê°’ \(r^{(i)}\)ì™€ ì˜¤í† ì¸ì½”ë”ë¥¼ í†µí•´ ì¬êµ¬ì„±í•œ ì…ë ¥ê°’ ê°„ì˜ ì˜¤ì°¨ë¥¼ êµ¬í•´ ê·¸ ì˜¤ì°¨ë¥¼ ì¤„ì—¬ë‚˜ê°€ëŠ” ê²ƒì…ë‹ˆë‹¤. ì…ë ¥ì„ ì¬êµ¬ì„±í•œ ê°’, ì¦‰ ì˜¤í† ì¸ì½”ë”ë¥¼ ê±°ì¹œ outputì€ ìˆ˜ì‹ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p> \[h(r;\theta) = f(W \\cdot g(Vr + \mu) + b)\] <p>\(f,g\)ëŠ” ê°ê° í™œì„±í™” í•¨ìˆ˜ì´ê³ , íŒŒë¼ë¯¸í„° ê°ê°ì˜ ì‚¬ì´ì¦ˆëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p> \[W \\in R^{d \times k} ,V \in R^{k \times d}, \mu \in R^{k},b \in R^{d}\] <p>ì—¬ê¸°ì„œ \(d\)ëŠ” m í˜¹ì€ nì´ê³  \(k\)ëŠ” hidden_layerì˜ feature ìˆ˜ ì…ë‹ˆë‹¤.</p> <p>Objective funtionì€ L2 lossë¥¼ ì†ì‹¤í•¨ìˆ˜ë¡œ ì‚¬ìš©í•˜ëŠ” L2 Regularizationì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p> <p><img src="https://user-images.githubusercontent.com/51329156/106887861-1d6dfe80-6729-11eb-9037-79926af7e822.png" alt="image" /></p> <p>\(\left \|\cdot\right \|_{O}^{2}\)ì˜ ì˜ë¯¸ëŠ” ê´€ì¸¡ëœ rating, ì¦‰ interaction matrixì—ì„œ ë¹„ì–´ìˆì§€ ì•Šì€ ìš”ì†Œì— ëŒ€í•´ì„œë§Œ ê³ ë ¤í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. MFì™€ëŠ” ë‹¬ë¦¬ \(g(\cdot)\)ì—ì„œ non-linear í•œ í™œì„±í™” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ latent vectorë¥¼ ë” ì˜ í‘œí˜„í•  ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.</p> <h2 id="pytorchë¡œ-êµ¬í˜„">PyTorchë¡œ êµ¬í˜„</h2> <h3 id="-dataset">ğŸ“– Dataset</h3> <p>ì „ì²´ ë°ì´í„°ì…‹ì„ train, test ì…‹ìœ¼ë¡œ ë‚˜ëˆ„ê³  <code class="language-plaintext highlighter-rouge">__getitem__()</code>ì—ì„œëŠ” ê° itemì— ëŒ€í•œ í‰ê°€ ë²¡í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'cuda'</span> <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s">'cpu'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MovielensDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">train_ratio</span><span class="o">=</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span> <span class="n">test_ratio</span><span class="o">=</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">train</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>
        <span class="c1"># self.index = index
</span>        <span class="c1"># self.columns = columns
</span>        <span class="c1"># self.values = values
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">rating_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">inter_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">rating_df</span><span class="p">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">).</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">train_ratio</span> <span class="o">=</span> <span class="n">train_ratio</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">test_ratio</span> <span class="o">=</span> <span class="n">test_ratio</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">total_indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">inter_matrix</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">test_indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">total_indices</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">inter_matrix</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">test_ratio</span><span class="p">),),</span> <span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">train_indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">total_indices</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">test_indices</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">train</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">train</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">inter_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">inter_matrix</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">train_indices</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">train</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">inter_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">inter_matrix</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">test_indices</span><span class="p">]</span> 
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">inter_matrix</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="s">"""
        get rating vector of one item(or user) : [0., 0., 4., 3., ..., 0., 0.]
        """</span>
        <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="n">Tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">inter_matrix</span><span class="p">[</span><span class="n">index</span><span class="p">]).</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</code></pre></div></div> <h3 id="-model">ğŸ“– Model</h3> <p>ì˜¤í† ì¸ì½”ë”ëŠ” <strong>encoder</strong>ì™€ <strong>decoder</strong>ë¡œ ì´ë£¨ì–´ì ¸ìˆë‹¤ê³  í–ˆìœ¼ë‹ˆ ëª¨ë¸ì—ì„œë„ ë˜‘ê°™ì´ êµ¬í˜„í•´ì¤ë‹ˆë‹¤. ìœ„ì˜ ìˆ˜ì‹ì—ì„œëŠ” \(h(\cdot)\)ì— í•´ë‹¹í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AutoRec</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="s">"""
    input -&gt; hidden -&gt; output(output.shape == input.shape)
    encoder: input -&gt; hidden
    decoder: hidden -&gt; output
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span><span class="p">,</span> <span class="n">n_factors</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AutoRec</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_factors</span> <span class="o">=</span> <span class="n">n_factors</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_users</span> <span class="o">=</span> <span class="n">n_users</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_items</span> <span class="o">=</span> <span class="n">n_items</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">n_users</span><span class="p">,</span><span class="bp">self</span><span class="p">.</span><span class="n">n_factors</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="n">Sigmoid</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">n_factors</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n_users</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="n">Identity</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">decoder</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)).</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">Sigmoid()</code>ì™€ <code class="language-plaintext highlighter-rouge">Identity()</code>ëŠ” ë…¼ë¬¸ì—ì„œ ì„±ëŠ¥ì´ ê°€ì¥ ì¢‹ì€ ì¡°í•©ì´ì—ˆìŠµë‹ˆë‹¤.</p> <h3 id="-criterion">ğŸ“– Criterion</h3> <p>ë…¼ë¬¸ì—ì„œ ê´€ì¸¡ëœ ratingì— ëŒ€í•´ì„œë§Œ ì˜¤ì°¨ë¥¼ ê²€ì‚¬í•œë‹¤ê³  í–ˆìœ¼ë‹ˆ ë¹„ì–´ìˆëŠ” ê°’ì€ ë¹¼ê³  ê³„ì‚°í•˜ê¸° ìœ„í•´ ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ RMSE í´ë˜ìŠ¤ì— ì•½ê°„ ìˆ˜ì •ì„ í–ˆìŠµë‹ˆë‹¤. ì œê°€ í•œ ë°©ë²• ë§ê³ ë„ numpyì˜ <code class="language-plaintext highlighter-rouge">nonzero()</code>ë¥¼ ì‚¬ìš©í•´ë„ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MRMSELoss</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="s">"""
    MaskedRootMSELoss() uses only observed ratings.
    According to docs(https://pytorch.org/docs/stable/generated/torch.nn.MSELoss.html), 
    'mean' is set by default for 'reduction' and can be avoided by 'reduction="sum"'
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s">'sum'</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">reduction</span> <span class="o">=</span> <span class="n">reduction</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">mse</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">reduction</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">rating</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">rating</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">masked_pred</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">*</span> <span class="n">mask</span><span class="p">.</span><span class="nb">float</span><span class="p">()</span>
        <span class="n">num_observed</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">reduction</span> <span class="o">==</span> <span class="s">'mean'</span> <span class="k">else</span> <span class="n">torch</span><span class="p">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">]).</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">mse</span><span class="p">(</span><span class="n">masked_pred</span><span class="p">,</span> <span class="n">rating</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_observed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loss</span>
</code></pre></div></div> <p>Objective functionì—ì„œ $\lambda$ ëŠ” Optimizerì— <code class="language-plaintext highlighter-rouge">weight_decay</code>ê°’ìœ¼ë¡œ ì£¼ë©´ ë©ë‹ˆë‹¤.</p> <p>ì‹¤í–‰ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">optim</span><span class="p">,</span><span class="n">cuda</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">AutoRec</span><span class="p">,</span> <span class="n">MRMSELoss</span>
<span class="kn">from</span> <span class="nn">data</span> <span class="kn">import</span> <span class="n">MovielensDataset</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="s">"""
AutoRec: Autoencoders Meet Collaborative Filtering implementation with PyTorch
"""</span>
<span class="c1"># Setting
</span><span class="k">def</span> <span class="nf">check_positive</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentError</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s"> is invalid value. epochs should be positive integer'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'AutoRec with PyTorch'</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--epochs'</span><span class="p">,</span> <span class="s">'-e'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">check_positive</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--batch'</span><span class="p">,</span> <span class="s">'-b'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">check_positive</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--lr'</span><span class="p">,</span> <span class="s">'-l'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'learning rate'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--wd'</span><span class="p">,</span> <span class="s">'-w'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'weight decay(lambda)'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--ksize'</span><span class="p">,</span> <span class="s">'-k'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">check_positive</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'hidden layer feature_size'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="n">path</span> <span class="o">=</span> <span class="s">'data/movielens/'</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'cuda'</span> <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s">'cpu'</span><span class="p">)</span>
<span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9724</span><span class="p">,</span> <span class="mi">610</span><span class="p">)</span>

<span class="c1"># Dataset &amp; Dataloader
</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">MovielensDataset</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">'ratings.csv'</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="s">'movieId'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s">'userId'</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">MovielensDataset</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">'ratings.csv'</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="s">'movieId'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s">'userId'</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">batch</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">test_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">batch</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Model &amp; Criterion
</span><span class="n">model</span> <span class="o">=</span> <span class="n">AutoRec</span><span class="p">(</span><span class="n">n_users</span><span class="o">=</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span><span class="o">=</span><span class="n">n_items</span><span class="p">,</span> <span class="n">n_factors</span><span class="o">=</span><span class="mi">200</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># Criterion &amp; Optimizer
</span><span class="n">criterion</span> <span class="o">=</span> <span class="n">MRMSELoss</span><span class="p">().</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="p">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">weight_decay</span><span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="n">wd</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">lr</span><span class="p">)</span>

<span class="c1"># Train &amp; Test
</span><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">epoch</span><span class="p">):</span>
    <span class="n">process</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_loader</span><span class="p">):</span>
        <span class="n">optimizer</span><span class="p">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">loss</span><span class="p">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optim</span><span class="p">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">process</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">.</span><span class="n">item</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="sa">f</span><span class="s">"[+] Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s"> [</span><span class="si">{</span><span class="n">idx</span> <span class="o">*</span> <span class="n">args</span><span class="p">.</span><span class="n">batch</span><span class="si">}</span><span class="s"> / </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">.</span><span class="n">dataset</span><span class="p">)</span><span class="si">}</span><span class="s">] - RMSE </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">process</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">process</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="n">Tensor</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">process</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">process</span><span class="p">)).</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">process</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_loader</span><span class="p">):</span>
        <span class="n">optimizer</span><span class="p">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">loss</span><span class="p">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optim</span><span class="p">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">process</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">.</span><span class="n">item</span><span class="p">())</span>
    <span class="k">print</span> <span class="p">(</span><span class="sa">f</span><span class="s">"[*] Test RMSE </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">process</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">process</span><span class="p">)</span><span class="si">}</span><span class="s"> "</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="n">Tensor</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">process</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">process</span><span class="p">)).</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    
<span class="c1"># Run
</span><span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">train_rmse</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">Tensor</span><span class="p">([]).</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">test_rmse</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">Tensor</span><span class="p">([]).</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">epochs</span><span class="p">):</span>
        <span class="n">train_rmse</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">((</span><span class="n">train_rmse</span><span class="p">,</span> <span class="n">train</span><span class="p">(</span><span class="n">epoch</span><span class="p">)),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">test_rmse</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">((</span><span class="n">test_rmse</span><span class="p">,</span> <span class="n">test</span><span class="p">()),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">epochs</span><span class="p">),</span><span class="n">train_rmse</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">epochs</span><span class="p">),</span><span class="n">test_rmse</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'epoch'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'RMSE'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">args</span><span class="p">.</span><span class="n">epochs</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div> <h3 id="result">Result</h3> <p><img src="https://user-images.githubusercontent.com/51329156/106747396-357d4980-6667-11eb-9b75-796767ce92de.png" alt="autoRec" /></p> <p>ë…¼ë¬¸ì—ì„œ ì œì‹œí•œ ê²°ê³¼ë§Œí¼ì€ ë‚´ë ¤ê°€ì§€ ì•ŠëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.. ê·¸ëƒ¥ í•œ ë²ˆ êµ¬í˜„í•´ë³¸ ê±°ì— ëŒ€í•´ ì˜ì˜ë¥¼ ê°€ì ¸ì•¼ í•  ê²ƒ ê°™ì•„ìš”.</p> <h3 id="conclusion">Conclusion</h3> <p>ë…¼ë¬¸ë„ ì§§ê³  ëª¨ë¸ë„ ë‹¨ìˆœí•´ì„œ êµ¬í˜„ì´ ìµìˆ™í•˜ì‹œì§€ ì•Šì€ ë¶„ë“¤ë„ ì‰½ê²Œ í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì½”ë“œ êµ¬í˜„ ì‹œ ê¶ê¸ˆí•œ ì  ìˆìœ¼ì‹œë©´ ë©”ì¼ ì£¼ì„¸ìš”. ê°ì‚¬í•©ë‹ˆë‹¤ !</p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script><!-- Author box --> <div class="card"> <div class="card-header"> About Jo Byeonggeun </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="https://www.bbangjo.kr/assets/img/authors/bbangjo.png" alt="Jo Byeonggeun" /> </div> <div class="col-md-6"> <p class="author_bio">Hello World</p> <p>Email : airmancho@korea.ac.kr</p> <p>Website : </p> <p class="profile-links"> <a class="social-link" href="https://github.com/bbangjooo" target="_blank"><i class="fab fa-github fa-fw"></i></a> </p> </div> </div> </div> </div> </div><div id="disqus_thread"></div> </article> <div id="disqus_thread"></div> <script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */ var disqus_config = function () { this.page.url = 'https://www.bbangjo.kr/blog/recsys-autorec'; this.page.identifier = 'https://www.bbangjo.kr/blog/recsys-autorec'; }; (function() { // DON'T EDIT BELOW THIS LINE var d = document, s = d.createElement('script'); s.src = 'https://blog-5znfc8zdfx.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About bbangjo</div> <div class="card-body"> <p class="author_bio">Hi, my name is Jo Byeonggeun.</p> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#Recommendation System"></div> <li class="tag-head"> <a href="/blog/categories/Recommendation System">Recommendation System</a> </li> <a name="Recommendation System"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="https://www.bbangjo.kr/">Home</a> </li> <li> <a href="https://www.bbangjo.kr/about">About</a> </li> <li> <a href="https://www.bbangjo.kr/blog">Blog</a> </li> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"><!-- Mailchimp Newletters --></div><footer> <p> Powered by<a href="https://github.com/sujaykundu777/devlopr-jekyll"> devlopr jekyll</a>.Hosted at <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'progressline', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script src="https://www.bbangjo.kr/assets/js/mode-switcher.js"></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> <!-- olvy releases --> <!-- <script> var OlvyConfig = { organisation: "", target: "#olvy-target", type: "", view: { showSearch: true, compact: true, showHeader: true, /* only applies when widget type is embed. you cannot hide header for modal and sidebar widgets */ showUnreadIndicator: true, unreadIndicatorColor: "#FFA13AFF", unreadIndicatorPosition: "top-right" } }; </script> <script type="text/javascript" src="https://app.olvy.co/script.js" defer="defer"></script> --> </body> </html>
